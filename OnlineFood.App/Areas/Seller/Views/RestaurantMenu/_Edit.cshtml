@model EditRestaurantMenuViewModel

<fieldset class="section ">
    <legend class="section-header restaurant-menu-create-header-icon "> ویرایش </legend>
    <div id="restaurant-menu-create-main">
        <div class="row">
            <div class="col-lg-12">
                <div class="actions-panel-top">
                    <button id="restaurant-menu-submit" type="button" class="btn btn-green btn-medium btn-3e btn-icon next-step"><i class="im im-icon-Save"></i>ثبت غذا</button>
                    <a id="restaurant-menu-back" class="btn btn-default btn-medium btn-3e btn-icon next-step"><i class="im im-icon-Back"></i>بازگشت</a>
                </div>
                <form asp-action="edit" asp-controller="restaurantmenu" asp-area="seller" method="post" id="frm-restaurantmenu-edit">
                    <input type="hidden" asp-for="RestaurantImageId" />
                    <input type="hidden" asp-for="RestaurantId" />
                    <input type="hidden" asp-for="RestaurantFoodCategoryId" />
                    <input type="hidden" asp-for="Id" />
                    <div asp-validation-summary="All" class="ui danger message @(ViewData.ModelState.IsValid ? "hide" : "animated fadeInUp")">
                        <div class="header list-info">
                            خطا
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-6 col-md-8 col-xs-12">
                            <div class="form-group form-float">
                                <div class="form-line focused">
                                    <i class="im im-icon-Plate prefix"></i>
                                    <input type="text" asp-for="Title" class="form-control" autocomplete="on">
                                    <label asp-for="Title" class="form-label"></label>
                                    <div class="user-helper-input tooltip-input">
                                        <ul class="tooltip-text">
                                            <li class="list-item">
                                                نام تنها شامل حروف فارسی و اعداد میباشد
                                            </li>
                                            <li class="list-item">
                                                حداکثر کاراکتر 25 میباشد
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <span asp-validation-for="Title" class="text-danger invalid label"></span>
                            </div>
                        </div>
                        <div class="col-lg-6 col-md-8 col-xs-12">
                            <div class="form-group form-float">
                                <div class="form-line focused">
                                    <i class="im im-icon-Pen prefix"></i>
                                    <input type="text" asp-for="Description" class="form-control" autocomplete="on">
                                    <label asp-for="Description" class="form-label"></label>
                                </div>
                                <span asp-validation-for="Description" class="text-danger invalid label"></span>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-6 col-md-8 col-xs-12">
                            <div class="form-group form-float">
                                <div class="form-line focused">
                                    <i class="im im-icon-Money prefix"></i>
                                    <input type="text" asp-for="Price" class="form-control amount ltr-direction" autocomplete="off">
                                    <label asp-for="Price" class="form-label price"></label>
                                </div>
                                <span asp-validation-for="Price" class="text-danger invalid label"></span>
                            </div>
                        </div>
                        <div class="col-lg-6 col-md-8 col-xs-12">
                            <div class="form-group form-float">
                                <div class="form-line @(Model.PriceDescription!=null? "focused": "")">
                                    <i class="im im-icon-Pen prefix"></i>
                                    <input type="text" asp-for="PriceDescription" class="form-control" autocomplete="on">
                                    <label asp-for="PriceDescription" class="form-label"></label>
                                </div>
                                <span asp-validation-for="PriceDescription" class="text-danger invalid label"></span>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-6 col-md-8 col-xs-12">
                            <div class="form-group form-float">
                                <div class="form-line focused ">
                                    <i class="im im-icon-Plate prefix"></i>
                                    <input type="text" asp-for="RestaurantFoodCategory" class="form-control" autocomplete="on">
                                    <label asp-for="RestaurantFoodCategory" class="form-label"></label>
                                </div>
                                <span asp-validation-for="RestaurantFoodCategory" class="text-danger invalid label"></span>
                            </div>
                        </div>
                    </div>
                    <!-- آپلود تصویر -->
                    <div id="upload-info">
                        <fieldset class="section ">
                            <legend class="section-header im-icon-Upload-toCloud"> آپلود تصویر </legend>
                            <div id="upload-main">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="list-info"> لطفا به موارد زیر توجه فرمایید : </div>
                                        <ul class="list-info">
                                            <li><span> تصاویر باید کاملا صاف و واضح باشد. </span></li>
                                            <li><span> قالب تصویر غذا را می توانید از <a href="javascript:void(0);" class="lnk-effect">این لینک</a> تهیه کنید . </span></li>
                                            <li><span> کیفیت نصویر در فروش شما تاثیر دارد </span></li>
                                            <li><span> تصویر عذا باید از انواع <strong>"jpg", "png", "jpeg"</strong> باشد. </span></li>
                                            <li><span> حجم تصویر غذا باید حداکثر <strong>@("2000".GetPersianNumber()) مگابایت</strong> باشد. </span></li>
                                        </ul>
                                    </div>
                                    <div class="col-lg-6 col-md-12 col-xs-12 text-center">
                                        <div class="form-control-label">
                                            <label asp-for="ImageFile" class="form-label upload-label"></label>
                                        </div>
                                        <div class="kv-avatar">
                                            <div class="file-loading">
                                                <input id="ImageFile" asp-for="ImageFile" type="file">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                    <div id="aniimated-thumbnials">
                        <fieldset class="section">
                            <legend class="section-header im-icon-Folder-Pictures"> گالری تصاویر </legend>
                            <div class="row">
                                <div class="col-lg-12 @(Model.GalleryRestaurantImageViewModels == null || !Model.GalleryRestaurantImageViewModels.Any() ? "empty-image-gallery" : "")" id="image-gallery-panel">
                                    @foreach (var item in Model.GalleryRestaurantImageViewModels)
                                    {
                                        <div class="col-lg-4 col-md-4 col-sm-6 col-xs-12 img-gallery-detail  @(item.Id == Model.RestaurantImageId ? "selected" : "")">
                                            <a onclick="RemoveImageGalleryPanel(this);" data-val="@item.Id"><i class="im im-icon-Close-Window" id="image-gallery-panel-remove" title="حذف"></i></a>
                                            <div class="centered">
                                                <label class="lbl-list-info-text">@item.Type</label>
                                            </div>
                                            <div class="centered">
                                                <label class="boxSub not-box-check inline-block">
                                                    <input type="checkbox" class="filled-in img-gallery-checkbox not-box-filled-in" @(item.Id == Model.RestaurantImageId ? "checked=\"checked\"" : "") name="RestaurantMenu" value="@item.Id" />
                                                    <span class="not-box-filled-in">این عکس میپسندم</span>
                                                </label>
                                            </div>
                                            <div class="centered justified-gallery ">
                                                <a href="@item.Url" class="zoom_light_gallery" data-sub-html="Demo Description" style="width: 187px;height: 126.144px;opacity: 1;">
                                                    <img class="img-responsive" src="@item.Url" title="@item.Type" style="width: 187px;height: 127px;margin-left: -93.5px;margin-top: -63.5px;">
                                                    <div class="demo-gallery-poster">
                                                        <img src="~/image/zoom.png" />
                                                    </div>
                                                </a>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </form>
            </div>
        </div>
    </div>
</fieldset>
<script type="text/javascript">
    $(function () {
        //config file input
        $("#ImageFile").fileinput({
            language: "fa",
            //theme: "fas",
            uploadUrl: "/seller/restaurantimage/upload/" + $("#RestaurantId").val(),
            overwriteInitial: true,
            maxFileSize: 1500,
            showClose: false,
            showCaption: false,
            showBrowse: false,
            //showPreview: false,
            browseOnZoneClick: true,
            removeLabel: '',
            //removeIcon: '<i class="glyphicon glyphicon-remove"></i>',
            removeTitle: 'حذف',
            //elErrorContainer: '#kv-avatar-errors-2',
            //msgErrorClass: 'alert alert-block alert-danger',
            defaultPreviewContent: '<img src="/image/item/upload-placeholder.jpg" alt="بارگزاری تصویر" title="بارگزاری تصویر">',
            layoutTemplates: { main2: '{preview} {browse}' },
            allowedFileExtensions: ["jpg", "png", "jpeg"],
                @* initialPreviewAsData: true,
            initialPreview: [frontOfNationalCardFileUrl],
                initialPreviewConfig: [
                    {
                        caption: '@Model.FrontOfNationalCardFileName',
                        width: '120px',
                        url: '/seller/sellerimage/delete/', // server delete action
                        key: 1,
                        extra: { id: @Model.FrontOfNationalCardFileId
    }
                    }
                ]*@
            }).on('fileuploaded', function (event, previewId, index, fileId) {
        debugger;
        if (previewId.response.success) {
            var html = '<div class="col-lg-4 col-md-4 col-sm-6 col-xs-12 img-gallery-detail">' +
                '<a onclick="RemoveImageGalleryPanel(this);" data-val="' + previewId.response.id + '"><i class="im im-icon-Close-Window" id="image-gallery-panel-remove" title="حذف"></i></a>' +
                '<div class="centered">' +
                '<label class="lbl-list-info-text">' + previewId.response.type + '</label>' +
                '</div>' +
                '<div class="centered">' +
                '<label class="boxSub not-box-check inline-block">' +
                '<input type="checkbox" class="filled-in img-gallery-checkbox not-box-filled-in" name="RestaurantMenu" value="' + previewId.response.id + '" />' +
                '<span class="not-box-filled-in">این عکس میپسندم</span>' +
                '</label>' +
                '</div>' +
                '<div class="centered justified-gallery ">' +
                '<a href="' + previewId.response.url + '"class="zoom_light_gallery" data-sub-html="Demo Description" style="width: 187px;height: 126.144px;opacity: 1;">' +
                '<img class="img-responsive" src="' + previewId.response.url + '" title="' + previewId.response.type + '" style="width: 187px;height: 127px;margin-left: -93.5px;margin-top: -63.5px;">' +
                '<div class="demo-gallery-poster">' +
                '<img src="/image/web/zoom.png"/>' +
                '</div>' +
                '</a>' +
                '</div>' +
                '</div>';
            $("#image-gallery-panel").removeClass("empty-image-gallery").append(html).lightGallery({
                thumbnail: true,
                selector: 'a.zoom_light_gallery'
            });
            //$('#aniimated-thumbnials').lightGallery({
            //    thumbnail: true,
            //    selector: 'a'
            //});
            ShowNotification('success', previewId.response.message, previewId.response.title, 'top', 'center', 'animated zoomInRight', 'animated zoomOutRight');
        }
        else {
            ShowNotification('danger', previewId.response.message, previewId.response.title, 'top', 'center', 'animated zoomInRight', 'animated zoomOutRight');
        }
        console.log('File Uploaded', 'ID: ' + fileId + ', Thumb ID: ' + previewId);
    }).on('fileuploaderror', function (event, data, msg) {
        debugger;
        $(event.target).parent().find(".kv-file-upload").attr("disabled", "disabled");
        ShowNotification('danger', msg, "خطا در ورود عکس", 'top', 'center', 'animated zoomInRight', 'animated zoomOutRight');
        console.log('File Upload Error', 'ID: ' + data.fileId + ', Thumb ID: ' + data.previewId);
            });


        $('#aniimated-thumbnials').lightGallery({
            thumbnail: true,
            selector: 'a.zoom_light_gallery',
        });
    })
    
    // Just a random third party autocomplete module. Nothing special about this. You can have your own autocomplete module
    // https://goodies.pixabay.com/javascript/auto-complete/demo.html
    var autoCompelete = new autoComplete({
        selector: 'input[name="RestaurantFoodCategory"]',
        minChars: 2,
        cache: 0,  // set to 1 if you need caching and making less requests
        source: function (term, response) {
            // Since we wont have full control over ajax responses and caching problems may occure if we directly
            // use geocoder.query, we build the request URL instead and then we use it our custom auto complete module.
            // It's a workaround for not getting cached results in our list.
            //var queryURL = geocoder.queryURL({ query: term, ne: globalSearchBoundingBox.ne, sw: globalSearchBoundingBox.sw });
            var queryURL = "/seller/restaurantmenu/getrestaurantfoodcategory";
            var restaurantId = $("#RestaurantId").val();
            // In this demo we use a tiny 3rd party library for AJAX requests as we don't use jQuery or other bulky libraries.
            // So feel free to replace it with your preferred one. jQuery syntax for example would be like: $.ajax()
            $.getJSON(queryURL, { q: term, restaurantId: restaurantId }, function (res) {
                debugger;
                var json = /*JSON.parse(res);*/ res;
                if (window.console) console.log(json);
                if (typeof json != 'undefined') {
                    if (json.results) response(json.results);
                    //no results
                    else { }
                }
                response(json.results);
            });
        },
        renderItem: function (item, search) {
            debugger;
            //alert('renderItem');
            var html;

            return '<div class="autocomplete-suggestion item-restaurant-food-cat-main" data-name="' + item.name + '" data-value="' + item.value + '">\
                                    <div class="item-restaurant-food-cat-sub"><i class="im  menu-category-icon ' + item.iconClassName + '"></i>' + item.text + '</div>\
                                </div>';
        },
        onSelect: function (e, term, item) {
            debugger;
            //get value of selected item of multi select
            var id = parseInt(item.getAttribute("data-value"));
            //get text of selected item of multi select
            var text = item.getAttribute("data-name")

            if (id > 0) {
                var restaurantFoodCategoryId = document.getElementById("RestaurantFoodCategoryId");
                restaurantFoodCategoryId.value = id;
                var restaurantFoodCategory = document.getElementById("RestaurantFoodCategory");
                restaurantFoodCategory.value = text;
            }
        }
    });
    
</script>